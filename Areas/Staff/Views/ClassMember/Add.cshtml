@model GreTutor.Areas.Staff.Models.ViewModels.AddClassMemberViewModel

@{
    ViewData["Title"] = "Add Members to Class";
    Layout = "_Layout";
}

<!-- Page Banner Start -->
@await Html.PartialAsync("_PageBannerStart")
<!-- Page Banner End -->

<h2 class="mt-3 text-center">Add Members to Class</h2>

<div class="container" style="max-width: 900px;">
    <form id="memberForm" method="post" action="/Staff/ClassMember/AddMultipleMembers">
        <input type="hidden" name="ClassId" value="@Model.ClassId" />

        <table class="table table-bordered table-sm">
            <thead class="thead-dark">
                <tr>
                    <th class="text-center">
                        <input type="checkbox" id="selectAll" />
                    </th>
                    <th class="text-center fs-4">User Name</th>
                    <th class="text-center fs-4">Email</th>
                    <th class="text-center fs-4">Role</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model.Users)
                {
                    <tr>
                        <td class="text-center align-middle">
                            <input type="checkbox" name="selectedUsers" value="@user.Id" class="user-checkbox" />
                        </td>
                        <td class="text-center align-middle fs-5">@user.UserName</td>
                        <td class="text-center align-middle fs-5">@user.Email</td>
                        <td class="text-center align-middle fs-5">
                            @if (string.IsNullOrEmpty(user.RoleNames))
                            {
                                <span class="badge bg-secondary">No Role</span>
                            }
                            else
                            {
                                <span class="badge bg-info">@user.RoleNames</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Button Add Selected -->
        <div class="text-center mt-3">
            <a href="@Url.Action("Index", "Class", new { area = "Staff" })" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Back to List
            </a>
            <button type="submit" class="btn btn-success">Add Selected</button>
        </div>
    </form>
</div>

<!-- Thêm JavaScript kiểm tra trước khi submit -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("memberForm");
        const checkboxes = document.querySelectorAll(".user-checkbox");
        const selectAllCheckbox = document.getElementById("selectAll");

        // Kiểm tra trước khi submit
        form.addEventListener("submit", function (event) {
            const checkedCount = document.querySelectorAll(".user-checkbox:checked").length;
            if (checkedCount === 0) {
                alert("Please select at least one member to add!");
                event.preventDefault(); // Ngăn form gửi đi nếu không có thành viên nào được chọn
            }
        });

        // Chức năng chọn tất cả
        selectAllCheckbox.addEventListener("change", function () {
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        });
    });
</script>
