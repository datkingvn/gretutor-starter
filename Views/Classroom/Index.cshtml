@model GreTutor.Models.ViewModels.ClassroomViewModel
@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager

@{
var currentUser = await UserManager.GetUserAsync(User);
var isStaff = User.IsInRole("Staff"); // Kiểm tra nếu user là Staff
}

@{
ViewData["Title"] = "Classroom";
Layout = "_Layout";
}

<!-- Page Banner Start -->
@await Html.PartialAsync("_PageBannerStart")
<!-- Page Banner End -->
<div class="section section-padding mt-n10">
    <div class="container">
        <h2 class="text-center mb-4">Classroom</h2>

        @if (!Model.ClassMembers.Any())
        {
        <div class="alert alert-warning text-center alert-dismissible fade show" role="alert">
            You have not joined any class yet. Please contact Staff to join the class.
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        }
        else
        {
        <div class="card shadow-lg p-4">
            <h4 class="text-center mb-3">List of Documents</h4>

            <div class="table-responsive">
                <table class="table table-striped table-hover text-center shadow-lg">
                    <thead class="table-dark">
                    <tr>
                        <th>Document Name</th>
                        <th>File</th>
                        <th>Uploaded At</th>
                        <th>Uploaded By</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var doc in Model.Documents)
                    {
                    <tr>
                        <td>@doc.FileName</td>
                        <td>
                            <a href="@doc.FilePath" target="_blank" class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-file-earmark-text"></i> View File
                            </a>
                        </td>
                        <td>@doc.UploadedAt.ToLocalTime()</td>
                        <td>@doc.UploadedBy?.UserName</td>
                        <td>
                            <a href="@Url.Action("Details", "Document", new { id = doc.Id })"
                               class="btn btn-info btn-sm text-white">
                                <i class="bi bi-info-circle"></i> Details
                            </a>
                            @if (currentUser != null && (currentUser.Id == doc.UploadedById || isStaff))
                            {
                            <form asp-action="DeleteDocument" asp-controller="Classroom" method="post" class="d-inline">
                                <input type="hidden" name="id" value="@doc.Id" />
                                <button type="submit" class="btn btn-danger btn-sm"
                                        onclick="return confirm('Are you sure you want to delete this document?');">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </form>
                            }
                        </td>
                    </tr>
                    }
                    </tbody>
                </table>
            </div>

            <div class="d-flex justify-content-center mt-4 gap-3">
                <a href="@Url.Action("Index", "Meeting", new { classId = Model.ClassMembers.FirstOrDefault()?.ClassId })"
                   class="btn btn-secondary px-4">
                    <i class="fas fa-video"></i> Meeting
                </a>
                <a href="@Url.Action("Classwork", "Classroom", new { classId = Model.ClassMembers.FirstOrDefault()?.ClassId })"
                   class="btn btn-primary px-4">
                    <i class="fas fa-glasses"></i> Classwork
                </a>
                <a href="@Url.Action("Index", "Chat", new { classId = Model.ClassMembers.FirstOrDefault()?.ClassId })"
                   class="btn btn-secondary px-4">
                    <i class="fas fa-comment-medical"></i> Chat Message
                </a>
                <a href="@Url.Action("People", "Classroom", new { classId = Model.ClassMembers.FirstOrDefault()?.ClassId })"
                   class="btn btn-primary px-4">
                    <i class="fas fa-users"></i> View Members
                </a>
            </div>
        </div>
        }
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<style>
    /* Additional custom styling */
    .alert {
        margin-top: 20px;
    }

    .table th, .table td {
        vertical-align: middle;
    }

    .table-hover tbody tr:hover {
        background-color: #f8f9fa;
    }

    .btn {
        font-size: 0.9rem;
        padding: 10px 20px;
    }

    .card {
        border-radius: 10px;
    }
</style>
